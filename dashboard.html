<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1"></script>
  <script src="https://code.jscharting.com/latest/jscharting.js"></script>
	<!-- My CSS -->
	
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
  
    <!-- Data From Firebase to DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.25/datatables.min.css" />
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.25/datatables.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js"></script>
  
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
    <!-- Include DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="css/dbstyle.css">
     
    <!-- Modal -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

      <Style>
         .labs{
          display: inline-block;
          width: 100px;
         }
      </Style>

	<title>Admin</title>
</head>
<body>


	<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<i class='bx bxs-smile'></i>
			<span class="text">Admin</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="dashboard.html">
					<i class='bx bxs-dashboard' ></i>
					<span class="text">Dashboard</span>
				</a>
			</li>

			

            <li>
				<a href="add.html">
					<i class='bx bxs-doughnut-chart' ></i>
					<span class="text">Add Records</span>
				</a>
			</li>

      <li>
				<a href="del.html">
					<i class='bx bxs-doughnut-chart' ></i>
					<span class="text">Delete Records</span>
				</a>
			</li>

		</ul>
		<ul class="side-menu">
			<li>
				<a href="#">
					<i class='bx bxs-cog' ></i>
					<span class="text">Settings</span>
				</a>
			</li>
        
			<li>
				<button class="logout" id="logout"> Logout</button>
					<i class='bx bxs-log-out-circle' ></i>
					
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->



	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu' ></i>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
				</div>
			</form>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell' ></i>
				<span class="num">8</span>
			</a>

			
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right' ></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>
	
			</div>

			<ul class="box-info">
                <li>
					<span class="text">
            <div id="chartContainer" style="width: 100%; height: 200px;"></div>
            <div class="form-group">
            </div>
					</span>
				</li>
			</ul>


			<div class="table-data">
				<div class="order">
					<div class="head">
						<h3>Survey</h3>
						<div class="form-input">
              <input type="search" id="searchInput" placeholder="Search..." oninput="searchTable()">
            </div>
					</div>
                    <table id="myTable" class="display">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Age</th>
                            <th>Race</th>
                            <th>Status</th>
                            <th>differentiate</th>
                            <th>Tumor Size</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody id="tbody1">
                        </tbody>
                      </table>
                      <div id="pagination"></div>
                      




				</div>
        


<!-- Modal -->
<div class="modal fade" id="staticBackdrop2" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h2>successfully Deleted!</h2>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal edit -->
<div class="modal fade" id="staticBackdrop1" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Edit</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body"name="edButton">
          <label for="ID" > ID</label>
          <input type="text" name="ID"id="IDED" readonly >
          <label for="name" > Name</label>
          <input type="text" name="name"id="nameED" >
          <label for="Age">Age</label>
          <input type="number" name="Age"id="ageED">
          <label for="Race">Race</label>
          <input type="text" name="Race"id="raceED">
          <label for="status">Status</label>
          <input type="text" name="status"id="statusED">
          <label for="differentiate">Differentiate</label>
          <input type="text" name="differentiate"id="differentiateED">
          <label for="Tsize">Tsize</label>
          <input type="text" name="Tsize"id="TsizeED">
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button id="edButton" type="button" class="btn btn-primary"onclick="edButt()">Edit</button>
      </div>
    </div>
  </div>
</div>


	</section>
  <script type="module">
   
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, setDoc, addDoc, doc, updateDoc,deleteDoc, getDoc, query, collection, where, getDocs, onSnapshot  } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
    
    
    
    const firebaseConfig = {
        apiKey: "AIzaSyDf39R3blGp39tn4ySNSNUXIUXA_wSvOu8",
        authDomain: "cancer-4c45d.firebaseapp.com",
        projectId: "cancer-4c45d",
        storageBucket: "cancer-4c45d.appspot.com",
        messagingSenderId: "52018598388",
        appId: "1:52018598388:web:8d3ab00e32cea4daa3a9a1",
        measurementId: "G-SVBN7TFVG6"
         };
         
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    console.log(app);

    //DataTables
    firebase.initializeApp(firebaseConfig);
    const db2 = firebase.firestore();  // Function for Database Firestore 
    
    
   
    
    //------------------------------------Get Data------------------------------------------//
    var dataNo =0;
    var datasets = [];
    var tbody = document.getElementById('tbody1');
    
    
    function AddItemToTable(id,name,age,race,status,differentiate,Tsize ){
      var trow = document.createElement('tr');
      // var td0 = document.createElement('td'); 
      var td1 = document.createElement('td');
      var td2 = document.createElement('td');
      var td3 = document.createElement('td');
      var td4 = document.createElement('td');
      var td5 = document.createElement('td');
      var td6 = document.createElement('td');
      var td7 = document.createElement('td');

    
    
      // td0.innerHTML = ''; 
      td1.innerHTML = ++dataNo;
      td2.innerHTML = name;
      td3.innerHTML = age;
      td4.innerHTML = race;
      td5.innerHTML = status;
      td6.innerHTML = differentiate;
      td7.innerHTML = Tsize;
     
      datasets.push([id,name, age,race, status, differentiate, Tsize]);
    
      // trow.appendChild(td0); 
      trow.appendChild(td1);
      trow.appendChild(td2);
      trow.appendChild(td3);
      trow.appendChild(td4);
      trow.appendChild(td5);
      trow.appendChild(td6);
      trow.appendChild(td7);
      var ControlDiv = document.createElement('div');
      ControlDiv.innerHTML = ' <button type="button" class="btn btn-primary my-2" data-toggle="modal" data-target="#staticBackdrop1" onclick="FillTboxes(' + dataNo + ',\'' + id + '\')">Update</button>';
      ControlDiv.innerHTML += ' <button type="button" class="btn btn-danger my-2 ml-2" data-toggle="modal" data-target="#exampleModalCenter" onclick="DelButt(\'' + id + '\')">Delete</button>';
    
      trow.appendChild(ControlDiv);
      tbody.appendChild(trow);
    
    }
    
    
    function populateTableList(Patients){
      dataNo=0;
      tbody.innerHTML="";
      Patients.forEach(element => {
        AddItemToTable(element.id,element.name,element.age,element.race,element.status,element.differentiate, element.Tsize);
    
      })
    }
    
    
    function GetAllDataRealtime(){
      const q = query(collection(db, "PatientRec"))
      const list = onSnapshot(q, (querySnapshot) => {
         var datasetss = [];
    
        querySnapshot.forEach(doc => {
          const data = doc.data();
          datasetss.push({...data, id: doc.id}); 
          console.log(doc.id)
        })
        datasetss.sort((a, b) => (a.country > b.country) ? 1 : -1);
        populateTableList(datasetss)
      })
    }
    
    window.onload = GetAllDataRealtime;
    
    
    //------------------------------------Edit Data------------------------------------------//
var ID1 = document.getElementById('IDED')   
var name1 = document.getElementById('nameED');
var age1 = document.getElementById('ageED');
var race1 = document.getElementById('raceED');
var status1 = document.getElementById('statusED');
var differentiate1 = document.getElementById('differentiateED');
var Tsize1 = document.getElementById('TsizeED');
var EditBtn = document.querySelector("#edButton");

window.FillTboxes = function(id, docId) {
  --id;
  ID1.value = datasets[id][0];
  name1.value = datasets[id][1];
  age1.value = datasets[id][2];
  race1.value = datasets[id][3];
  status1.value = datasets[id][4];
  differentiate1.value = datasets[id][5];
  Tsize1.value = datasets[id][6];
  EditBtn.dataset.id = docId;
};

const saveEdit = document.querySelector("#edButton")
saveEdit.addEventListener("click", async () =>{
  try {
    const docRef = doc(db,"PatientRec", EditBtn.dataset.id);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      await setDoc(docRef, {
        name: name1.value,
        age:  age1.value,
        race: race1.value,
        status: status1.value,
        differentiate: differentiate1.value,
        Tsize:Tsize1.value,

      });
    }
    const editDataModal = document.getElementById('staticBackdrop1');
    const modal = bootstrap.Modal.getInstance(editDataModal);
    modal.hide();
  } catch (error) {
    console.log(error)
  }
});



    //------------------------------------Delete Data------------------------------------------//
    
    //------------------------------------------------OG Delete Button
    window.DelButt = async function(id) {
      const docRef = doc(db, "PatientRec", id);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        await deleteDoc(docRef);
        setData(data.filter((item)=> item.id !==id));
        console.log(doc.id)
      } else {
        console.log("Document does not exist");
      }
    }
    
    
    
    
    function searchTable() {
  var input, filter, table, tr, td, i, j, txtValue;
  input = document.getElementById("searchInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("myTable");
  tr = table.getElementsByTagName("tr");

  for (i = 0; i < tr.length; i++) {
    var found = false;
    for (j = 0; j < tr[i].cells.length; j++) {
      td = tr[i].cells[j];
      if (td) {
        txtValue = td.textContent || td.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          found = true;
          break;
        }
      }
    }
    if (found) {
      tr[i].style.display = "";
    } else {
      tr[i].style.display = "none";
    }
  }
}
    
function updatePagination() {
  var pageSize = 10; // Number of rows per page
  var table = document.getElementById("myTable");
  var rows = table.getElementsByTagName("tr");

  // Hide all rows
  for (var i = 0; i < rows.length; i++) {
    rows[i].style.display = "none";
  }

  // Show the rows for the current page
  var currentPage = 1; // Set the current page number
  var start = (currentPage - 1) * pageSize + 1;
  var end = currentPage * pageSize;
  for (var j = start - 1; j < end && j < rows.length; j++) {
    rows[j].style.display = "";
  }

  // Update the pagination links
  var pagination = document.getElementById("pagination");
  var totalPages = Math.ceil(rows.length / pageSize);
  var paginationHTML = "";
  for (var k = 1; k <= totalPages; k++) {
    paginationHTML += "<a href='#' onclick='changePage(" + k + ")'>" + k + "</a>";
  }
  pagination.innerHTML = paginationHTML;
}

function changePage(page) {
  var pagination = document.getElementById("pagination");
  var links = pagination.getElementsByTagName("a");

  // Update the active page link
  for (var i = 0; i < links.length; i++) {
    links[i].classList.remove("active");
  }
  links[page - 1].classList.add("active");

  // Update the table rows
  updatePagination();
}

// Call updatePagination initially
updatePagination();



getDocs(collection(db, "PatientRec")).then(docSnap => {
  let teamsData = [];

  docSnap.forEach((doc)=> {

    const data = doc.data();
    const Status = data.status;
    const Tsize = data.Tsize;

    teamsData.push({ x:Status, y: Tsize  });
    console.log("New Document data:", 'Race');

  });

  // Create the chart using the retrieved data
  var chart = new JSC.Chart("chartContainer", {
    debug: true, // Set debug option to true to view full error messages

    type: "column",
    series: [{
        name: "between status and Tumor size",
      points:teamsData
    }
  ]
  });

})  .catch(function(error) {
  console.error("Error retrieving data from Firestore: ", error);
  });
    </script>
     
      
    
	
   
</body>


</html>